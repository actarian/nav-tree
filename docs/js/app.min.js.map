{"version":3,"sources":["docs/js/app.js"],"names":["angular","module","config","$httpProvider","$locationProvider","html5Mode","hashPrefix","run","$rootScope","controller","$scope","$http","$timeout","$promise","Nav","onLink","item","link","url","console","log","$nav","level","onNav","silent","nav","get","then","response","setItems","data","error","app","directive","$parse","restrict","templateUrl","element","attributes","template","scope","items","model","$watch","value","isArray","$parent","itemOpen","immediate","state","active","closed","closing","opening","opened","itemClose","forEach","o","itemToggle","parent","onTap","e","trigger","output","promise","resolved","rejected","onTouchStart","navItem","off","onMouseDown","onClick","prevent","preventDefault","removeListeners","querySelector","on","$on","factory","$silent","options","this","defaults","extend","setNav","prototype","path","setNavs","addItems","x","getLink","itemOrItems","addItem","push","statics","$q","callback","deferred","defer","all","promises","$location","unlink","listeners","$$listeners","$locationChangeSuccess","name","relink","listener","$path","replace","location","unshift"],"mappings":"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","file":"app.min.js","sourcesContent":["/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app', ['ngRoute', 'jsonFormatter']);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n    app.config(['$httpProvider', function($httpProvider) {\n        // $httpProvider.defaults.withCredentials = true;\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n    app.config(['$locationProvider', function($locationProvider) {\n\n        // HTML5 MODE url writing method (false: #/anchor/use, true: /html5/url/use)\n        $locationProvider.html5Mode(false);\n        $locationProvider.hashPrefix('');\n\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n    app.run(['$rootScope', function($rootScope) {\n\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n    app.controller('RootCtrl', ['$scope', '$http', '$timeout', '$promise', 'Nav', function($scope, $http, $timeout, $promise, Nav) {\n\n        var nav = new Nav({\n            onLink: onLink,\n            onNav: onNav,\n        });\n\n        $http.get('json/menu.js').then(function(response) {\n            // $scope.items = response.data;\n            nav.setItems(response.data);\n\n        }, function(error) {\n            console.log('RootCtrl.error', error);\n\n        });\n\n        function onLink(item) {\n            var link = item.url;\n            console.log('RootCtrl.onLink', item.$nav.level, link);\n            return link;\n        }\n\n        function onNav(item) {\n            console.log('RootCtrl.onNav', item.$nav.level, item.$nav.link);\n            Nav.silent(item.$nav.link);\n            return false; // returning false disable default link behaviour;\n        }\n\n        function onNavPromise(item) {\n            $scope.selected = item;\n            return $promise(function(promise) {\n                console.log('RootCtrl.onNavPromise', item.$nav.level, item.$nav.link);\n                $timeout(function() {\n                    if (item.items) {\n                        item.$nav.addItems({\n                            name: \"Item\",\n                        });\n                    }\n                    promise.resolve();\n                });\n            }); // a promise always disable default link behaviour;\n        }\n\n        $scope.nav = nav;\n\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n    app.directive('nav', ['$parse', 'Nav', function($parse, Nav) {\n        return {\n            restrict: 'A',\n            templateUrl: function(element, attributes) {\n                return attributes.template || 'partials/nav/nav';\n            },\n            scope: {\n                items: '=nav',\n            },\n            link: function(scope, element, attributes, model) {\n                scope.$watch('items', function(value) {\n                    // console.log(value instanceof Nav, value);\n                    if (value) {\n                        if (angular.isArray(value)) {\n                            var onLink = $parse(attributes.onLink)(scope.$parent);\n                            var onNav = $parse(attributes.onNav)(scope.$parent);\n                            var nav = new Nav({\n                                onLink: onLink,\n                                onNav: onNav\n                            });\n                            nav.setItems(value);\n                            scope.item = nav;\n\n                        } else if (value instanceof Nav) {\n                            scope.item = value;\n                        }\n                    }\n                });\n            }\n        };\n    }]);\n\n    app.directive('navItem', ['$timeout', function($timeout) {\n        return {\n            restrict: 'A',\n            templateUrl: function(element, attributes) {\n                return attributes.template || 'partials/nav/nav-item';\n            },\n            scope: {\n                item: '=navItem',\n            },\n            link: function(scope, element, attributes, model) {\n                var navItem = angular.element(element[0].querySelector('.nav-link'));\n\n                var output;\n\n                function itemOpen(item, immediate) {\n                    var state = item.$nav.state;\n                    state.active = true;\n\n                    $timeout(function() {\n                        state.immediate = immediate;\n                        state.closed = state.closing = false;\n                        state.opening = true;\n                        $timeout(function() {\n                            state.opening = false;\n                            state.opened = true;\n                        });\n                    });\n                }\n\n                function itemClose(item, immediate) {\n                    var state = item.$nav.state;\n                    state.active = false;\n                    $timeout(function() {\n                        state.immediate = immediate;\n                        state.opened = state.opening = false;\n                        state.closing = true;\n                        $timeout(function() {\n                            state.closing = false;\n                            state.closed = true;\n                        });\n                    });\n                    if (item.items) {\n                        angular.forEach(item.items, function(o) {\n                            itemClose(o, true);\n                        });\n                    }\n                }\n\n                function itemToggle(item) {\n                    // console.log('itemToggle', item);\n                    var state = item.$nav.state;\n                    state.active = item.items ? !state.active : true;\n                    if (state.active) {\n                        if (item.$nav.parent) {\n                            angular.forEach(item.$nav.parent.items, function(o) {\n                                if (o !== item) {\n                                    itemClose(o, true);\n                                }\n                            });\n                        }\n                        itemOpen(item);\n                    } else {\n                        itemClose(item);\n                    }\n                    // console.log(state);\n                }\n\n                function onTap(e) {\n                    var item = scope.item;\n                    // console.log('Item.onTap', item);\n                    var state = item.$nav.state;\n                    if (state.active) {\n                        output = false;\n                        trigger();\n                    } else if (item.$nav.onNav) {\n                        var promise = item.$nav.onNav(item, item.$nav);\n                        if (promise && typeof promise.then === 'function') {\n                            promise.then(function(resolved) {\n                                // go on\n                                trigger();\n                            }, function(rejected) {\n                                // do nothing\n                            });\n                            output = false;\n                        } else {\n                            output = promise;\n                            trigger();\n                        }\n                    }\n\n                    function trigger() {\n                        $timeout(function() {\n                            itemToggle(item);\n                        });\n                    }\n                }\n\n                function onTouchStart(e) {\n                    // console.log('Item.onTouchStart', e);\n                    onTap(e);\n                    navItem\n                        .off('mousedown', onMouseDown);\n                    // return r || prevent(e);\n                }\n\n                function onMouseDown(e) {\n                    // console.log('Item.onMouseDown', e);\n                    onTap(e);\n                    navItem\n                        .off('touchstart', onTouchStart);\n                    // return r || prevent(e);\n                }\n\n                function onClick(e) {\n                    // console.log('Item.onClick', e);\n                    return prevent(e);\n                }\n\n                function prevent(e) {\n                    if (output === false) {\n                        // console.log('Item.prevent', e);\n                        e.preventDefault();\n                        // e.stopPropagation();\n                        return false;\n                    }\n                }\n\n                function addListeners() {\n                    navItem\n                        .on('touchstart', onTouchStart)\n                        .on('mousedown', onMouseDown)\n                        .on('click', onClick);\n                }\n\n                function removeListeners() {\n                    navItem\n                        .off('touchstart', onTouchStart)\n                        .off('mousedown', onMouseDown)\n                        .off('click', onClick);\n                }\n\n                addListeners();\n\n                scope.$on('$destroy', function() {\n                    removeListeners();\n                });\n            }\n        };\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n    app.factory('Nav', ['$silent', function($silent) {\n        function Nav(options) {\n            var nav = this;\n            var defaults = {\n                items: [],\n            }\n            angular.extend(nav, defaults);\n            if (options) {\n                angular.extend(nav, options);\n            }\n            nav.setNav(nav, null);\n        }\n        Nav.prototype = {\n            setItems: function(items) {\n                var nav = this;\n                nav.path = $silent.path();\n                nav.items = items;\n                nav.setNavs(items, nav);\n            },\n            setNavs: function(items, parent) {\n                var nav = this;\n                if (items) {\n                    angular.forEach(items, function(item) {\n                        nav.setNav(item, parent);\n                        nav.setNavs(item.items, item);\n                    });\n                }\n            },\n            setNav: function(item, parent) {\n                var nav = this;\n                var $nav = {\n                    parent: parent || null,\n                    level: parent ? parent.$nav.level + 1 : 0,\n                    state: {},\n                    addItems: function(x) {\n                        nav.addItems(x, item);\n                    },\n                    onNav: nav.onNav,\n                };\n                item.$nav = $nav;\n                $nav.link = nav.getLink(item);\n                if ($nav.link === nav.path) {\n                    $nav.state.active = true;\n                    $nav.state.opened = true;\n                    while ($nav.parent) {\n                        $nav = $nav.parent.$nav;\n                        $nav.state.active = true;\n                        $nav.state.opened = true;\n                    }\n                }\n            },\n            addItems: function(itemOrItems, parent) {\n                var nav = this;\n                if (angular.isArray(itemOrItems)) {\n                    angular.forEach(itemOrItems, function(item) {\n                        nav.addItem(item, parent);\n                    });\n                } else {\n                    nav.addItem(itemOrItems, parent);\n                }\n            },\n            addItem: function(item, parent) {\n                var nav = this,\n                    onLink = nav.onLink,\n                    onNav = nav.onNav;\n                nav.setNav(item, parent);\n                if (parent) {\n                    parent.items = parent.items || [];\n                    parent.items.push(item);\n                }\n            },\n            getLink: function(item) {\n                var link = null;\n                if (this.onLink) {\n                    link = this.onLink(item, item.$nav);\n                } else {\n                    link = item.link;\n                }\n                return link;\n            },\n        };\n        var statics = {\n            silent: function(path) {\n                $silent.silent(path);\n            },\n            path: function(path) {\n                $silent.path(path);\n            },\n        };\n        angular.extend(Nav, statics);\n        return Nav;\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n    app.factory('$promise', ['$q', function($q) {\n        function $promise(callback) {\n            if (typeof callback !== 'function') {\n                throw ('promise resolve callback missing');\n            }\n            var deferred = $q.defer();\n            callback(deferred);\n            return deferred.promise;\n        }\n        var statics = {\n            all: function(promises) {\n                return $q.all(promises);\n            },\n        };\n        angular.extend($promise, statics);\n        return $promise;\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n    app.factory('$silent', ['$rootScope', '$location', function($rootScope, $location) {\n        function $silent() {}\n\n        var $path;\n\n        function unlink() {\n            var listeners = $rootScope.$$listeners.$locationChangeSuccess;\n            angular.forEach(listeners, function(value, name) {\n                if (value === listener) {\n                    return;\n                }\n\n                function relink() {\n                    listeners[name] = value;\n                }\n                listeners[name] = relink; // temporary unlinking\n            });\n        }\n\n        function listener(e) {\n            // console.log('onLocationChangeSuccess', e);\n            if ($path === $location.path()) {\n                unlink();\n            }\n            $path = null;\n        }\n\n        var statics = {\n            silent: function(path, replace) {\n                // this.prev = $location.path(); ???\n                var location = $location.url(path);\n                if (replace) {\n                    location.replace();\n                }\n                $path = $location.path();\n            },\n            path: function(path) {\n                return $location.path(path);\n            },\n        };\n\n        angular.extend($silent, statics);\n        $rootScope.$$listeners.$locationChangeSuccess.unshift(listener);\n        // console.log('$rootScope.$$listeners.$locationChangeSuccess', $rootScope.$$listeners.$locationChangeSuccess);\n        return $silent;\n    }]);\n\n}());"]}