{"version":3,"sources":["docs/js/app.js"],"names":["angular","module","config","$httpProvider","$locationProvider","html5Mode","hashPrefix","run","$rootScope","controller","$scope","$http","$timeout","$promise","Nav","onLink","item","link","url","console","log","$nav","level","onNav","silent","nav","get","then","response","setItems","data","error","app","factory","$silent","options","this","defaults","items","extend","addNav","prototype","parent","state","addItems","x","getLink","path","active","opened","addItem","push","itemOrItems","isArray","forEach","parse","statics","directive","$parse","restrict","templateUrl","element","attributes","template","scope","model","$watch","value","$parent","itemOpen","immediate","closed","closing","opening","itemClose","o","itemToggle","onTap","e","trigger","output","promise","resolved","rejected","onTouchStart","navItem","off","onMouseDown","onClick","prevent","preventDefault","removeListeners","querySelector","on","$on","$location","unlink","listeners","$$listeners","$locationChangeSuccess","name","relink","listener","$path","replace","location","unshift","$q","callback","deferred","defer","all","promises"],"mappings":"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","file":"app.min.js","sourcesContent":["/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app', ['ngRoute', 'jsonFormatter']);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n    app.config(['$httpProvider', function($httpProvider) {\n        // $httpProvider.defaults.withCredentials = true;\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n    app.config(['$locationProvider', function($locationProvider) {\n\n        // HTML5 MODE url writing method (false: #/anchor/use, true: /html5/url/use)\n        $locationProvider.html5Mode(false);\n        $locationProvider.hashPrefix('');\n\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n    app.run(['$rootScope', function($rootScope) {\n\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n    app.controller('RootCtrl', ['$scope', '$http', '$timeout', '$promise', 'Nav', function($scope, $http, $timeout, $promise, Nav) {\n\n        var nav = new Nav({\n            onLink: onLink,\n            onNav: onNav,\n        });\n\n        $http.get('json/menu.js').then(function(response) {\n            // $scope.items = response.data;\n            nav.setItems(response.data);\n\n        }, function(error) {\n            console.log('RootCtrl.error', error);\n        });\n\n        function onLink(item) {\n            var link = item.url;\n            console.log('RootCtrl.onLink', item.$nav.level, link);\n            return link;\n        }\n\n        function onNav(item) {\n            console.log('RootCtrl.onNav', item.$nav.level, item.$nav.link);\n            Nav.silent(item.$nav.link);\n            return false; // returning false disable default link behaviour;\n        }\n\n        function onNavPromise(item) {\n            $scope.selected = item;\n            return $promise(function(promise) {\n                console.log('RootCtrl.onNavPromise', item.$nav.level, item.$nav.link);\n                $timeout(function() {\n                    if (item.items) {\n                        item.$nav.addItems({\n                            title: \"Item\",\n                        });\n                    }\n                    promise.resolve();\n                });\n            }); // a promise always disable default link behaviour;\n        }\n\n        $scope.nav = nav;\n\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n    app.factory('Nav', ['$silent', function($silent) {\n        function Nav(options) {\n            var nav = this;\n            var defaults = {\n                items: [],\n            }\n            angular.extend(nav, defaults);\n            if (options) {\n                angular.extend(nav, options);\n            }\n            nav.addNav(nav, null);\n        }\n        Nav.prototype = {\n            addNav: function(item, parent) {\n                var nav = this;\n                var $nav = {\n                    parent: parent || null,\n                    level: parent ? parent.$nav.level + 1 : 0,\n                    state: {},\n                    addItems: function(x) {\n                        nav.addItems(x, item);\n                    },\n                    onNav: nav.onNav,\n                };\n                item.$nav = $nav;\n                $nav.link = nav.getLink(item);\n                if ($nav.link === nav.path) {\n                    $nav.state.active = true;\n                    $nav.state.opened = true;\n                    while ($nav.parent) {\n                        $nav = $nav.parent.$nav;\n                        $nav.state.active = true;\n                        $nav.state.opened = true;\n                    }\n                }\n            },\n            getLink: function(item) {\n                var link = null;\n                if (this.onLink) {\n                    link = this.onLink(item, item.$nav);\n                } else {\n                    link = item.link;\n                }\n                return link;\n            },\n            addItem: function(item, parent) {\n                var nav = this,\n                    onLink = nav.onLink,\n                    onNav = nav.onNav;\n                nav.addNav(item, parent);\n                if (parent) {\n                    parent.items = parent.items || [];\n                    parent.items.push(item);\n                }\n            },\n            addItems: function(itemOrItems, parent) {\n                var nav = this;\n                if (angular.isArray(itemOrItems)) {\n                    angular.forEach(itemOrItems, function(item) {\n                        nav.addItem(item, parent);\n                    });\n                } else {\n                    nav.addItem(itemOrItems, parent);\n                }\n            },\n            parse: function(items, parent) {\n                var nav = this;\n                if (items) {\n                    angular.forEach(items, function(item) {\n                        nav.addNav(item, parent);\n                        nav.parse(item.items, item);\n                    });\n                }\n            },\n            setItems: function(items) {\n                var nav = this;\n                nav.path = $silent.path();\n                nav.items = items;\n                nav.parse(items, nav);\n            },\n        };\n        var statics = {\n            silent: function(path) {\n                $silent.silent(path);\n            },\n            path: function(path) {\n                $silent.path(path);\n            },\n        };\n        angular.extend(Nav, statics);\n        return Nav;\n    }]);\n\n    app.directive('nav', ['$parse', 'Nav', function($parse, Nav) {\n        return {\n            restrict: 'A',\n            templateUrl: function(element, attributes) {\n                return attributes.template || 'partials/nav/nav';\n            },\n            scope: {\n                items: '=nav',\n            },\n            link: function(scope, element, attributes, model) {\n                scope.$watch('items', function(value) {\n                    // console.log(value instanceof Nav, value);\n                    if (value) {\n                        if (angular.isArray(value)) {\n                            var onLink = $parse(attributes.onLink)(scope.$parent);\n                            var onNav = $parse(attributes.onNav)(scope.$parent);\n                            var nav = new Nav({\n                                onLink: onLink,\n                                onNav: onNav\n                            });\n                            nav.setItems(value);\n                            scope.item = nav;\n\n                        } else if (value instanceof Nav) {\n                            scope.item = value;\n                        }\n                    }\n                });\n            }\n        };\n    }]);\n\n    app.directive('navItem', ['$timeout', function($timeout) {\n        return {\n            restrict: 'A',\n            templateUrl: function(element, attributes) {\n                return attributes.template || 'partials/nav/nav-item';\n            },\n            scope: {\n                item: '=navItem',\n            },\n            link: function(scope, element, attributes, model) {\n                var navItem = angular.element(element[0].querySelector('.nav-link'));\n\n                var output;\n\n                function itemOpen(item, immediate) {\n                    var state = item.$nav.state;\n                    state.active = true;\n\n                    $timeout(function() {\n                        state.immediate = immediate;\n                        state.closed = state.closing = false;\n                        state.opening = true;\n                        $timeout(function() {\n                            state.opening = false;\n                            state.opened = true;\n                        });\n                    });\n                }\n\n                function itemClose(item, immediate) {\n                    var state = item.$nav.state;\n                    state.active = false;\n                    $timeout(function() {\n                        state.immediate = immediate;\n                        state.opened = state.opening = false;\n                        state.closing = true;\n                        $timeout(function() {\n                            state.closing = false;\n                            state.closed = true;\n                        });\n                    });\n                    if (item.items) {\n                        angular.forEach(item.items, function(o) {\n                            itemClose(o, true);\n                        });\n                    }\n                }\n\n                function itemToggle(item) {\n                    // console.log('itemToggle', item);\n                    var state = item.$nav.state;\n                    state.active = item.items ? !state.active : true;\n                    if (state.active) {\n                        if (item.$nav.parent) {\n                            angular.forEach(item.$nav.parent.items, function(o) {\n                                if (o !== item) {\n                                    itemClose(o, true);\n                                }\n                            });\n                        }\n                        itemOpen(item);\n                    } else {\n                        itemClose(item);\n                    }\n                    // console.log(state);\n                }\n\n                function onTap(e) {\n                    var item = scope.item;\n                    // console.log('Item.onTap', item);\n                    var state = item.$nav.state;\n                    if (state.active) {\n                        output = false;\n                        trigger();\n                    } else if (item.$nav.onNav) {\n                        var promise = item.$nav.onNav(item, item.$nav);\n                        if (promise && typeof promise.then === 'function') {\n                            promise.then(function(resolved) {\n                                // go on\n                                trigger();\n                            }, function(rejected) {\n                                // do nothing\n                            });\n                            output = false;\n                        } else {\n                            output = promise;\n                            trigger();\n                        }\n                    }\n\n                    function trigger() {\n                        $timeout(function() {\n                            itemToggle(item);\n                        });\n                    }\n                }\n\n                function onTouchStart(e) {\n                    // console.log('Item.onTouchStart', e);\n                    onTap(e);\n                    navItem\n                        .off('mousedown', onMouseDown);\n                    // return r || prevent(e);\n                }\n\n                function onMouseDown(e) {\n                    // console.log('Item.onMouseDown', e);\n                    onTap(e);\n                    navItem\n                        .off('touchstart', onTouchStart);\n                    // return r || prevent(e);\n                }\n\n                function onClick(e) {\n                    // console.log('Item.onClick', e);\n                    return prevent(e);\n                }\n\n                function prevent(e) {\n                    if (output === false) {\n                        // console.log('Item.prevent', e);\n                        e.preventDefault();\n                        // e.stopPropagation();\n                        return false;\n                    }\n                }\n\n                function addListeners() {\n                    navItem\n                        .on('touchstart', onTouchStart)\n                        .on('mousedown', onMouseDown)\n                        .on('click', onClick);\n                }\n\n                function removeListeners() {\n                    navItem\n                        .off('touchstart', onTouchStart)\n                        .off('mousedown', onMouseDown)\n                        .off('click', onClick);\n                }\n\n                addListeners();\n\n                scope.$on('$destroy', function() {\n                    removeListeners();\n                });\n            }\n        };\n    }]);\n\n    app.factory('$silent', ['$rootScope', '$location', function($rootScope, $location) {\n        function $silent() {}\n\n        var $path;\n\n        function unlink() {\n            var listeners = $rootScope.$$listeners.$locationChangeSuccess;\n            angular.forEach(listeners, function(value, name) {\n                if (value === listener) {\n                    return;\n                }\n\n                function relink() {\n                    listeners[name] = value;\n                }\n                listeners[name] = relink; // temporary unlinking\n            });\n        }\n\n        function listener(e) {\n            // console.log('onLocationChangeSuccess', e);\n            if ($path === $location.path()) {\n                unlink();\n            }\n            $path = null;\n        }\n\n        var statics = {\n            silent: function(path, replace) {\n                // this.prev = $location.path(); ???\n                var location = $location.url(path);\n                if (replace) {\n                    location.replace();\n                }\n                $path = $location.path();\n            },\n            path: function(path) {\n                return $location.path(path);\n            },\n        };\n\n        angular.extend($silent, statics);\n        $rootScope.$$listeners.$locationChangeSuccess.unshift(listener);\n        // console.log('$rootScope.$$listeners.$locationChangeSuccess', $rootScope.$$listeners.$locationChangeSuccess);\n        return $silent;\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n    app.factory('$promise', ['$q', function($q) {\n        function $promise(callback) {\n            if (typeof callback !== 'function') {\n                throw ('promise resolve callback missing');\n            }\n            var deferred = $q.defer();\n            callback(deferred);\n            return deferred.promise;\n        }\n        var statics = {\n            all: function(promises) {\n                return $q.all(promises);\n            },\n        };\n        angular.extend($promise, statics);\n        return $promise;\n    }]);\n\n}());"]}