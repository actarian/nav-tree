{"version":3,"sources":["docs/js/app.js"],"names":["angular","module","config","$httpProvider","$locationProvider","html5Mode","hashPrefix","run","$rootScope","controller","$scope","$http","$timeout","$promise","Nav","onLink","item","link","url","console","log","$nav","level","onNav","nav","get","then","response","setItems","data","error","app","factory","options","this","defaults","items","extend","addNav","prototype","parent","addItems","x","getLink","addItem","push","itemOrItems","isArray","forEach","parse","directive","$parse","restrict","templateUrl","element","attributes","template","scope","model","$watch","value","$parent","itemOpen","immediate","state","active","closed","closing","opening","opened","itemClose","o","itemToggle","onTap","e","trigger","output","promise","resolved","rejected","onTouchStart","navItem","off","onMouseDown","onClick","prevent","preventDefault","removeListeners","querySelector","on","$on","$q","callback","deferred","defer"],"mappings":"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","file":"app.min.js","sourcesContent":["/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app', ['ngRoute', 'jsonFormatter']);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n    app.config(['$httpProvider', function($httpProvider) {\n        // $httpProvider.defaults.withCredentials = true;\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n    app.config(['$locationProvider', function($locationProvider) {\n\n        // HTML5 MODE url writing method (false: #/anchor/use, true: /html5/url/use)\n        $locationProvider.html5Mode(false);\n        $locationProvider.hashPrefix('');\n\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n    app.run(['$rootScope', function($rootScope) {\n\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n    app.controller('RootCtrl', ['$scope', '$http', '$timeout', '$promise', 'Nav', function($scope, $http, $timeout, $promise, Nav) {\n\n        var nav = new Nav({\n            onLink: onLink,\n            onNav: onNav,\n        });\n\n        $http.get('json/menu.js').then(function(response) {\n            // $scope.items = response.data;\n            nav.setItems(response.data);\n\n        }, function(error) {\n            console.log('RootCtrl.error', error);\n        });\n\n        function onLink(item) {\n            var link = item.url;\n            /*\n            link = link ? '#' + link : '#';\n            if (item.years) {\n                var key = String(item.years.to ? item.years.from + '-' + item.years.to : item.years.from); // da riattivare !!!\n                link = '/years/' + key;\n            }\n            */\n            console.log('RootCtrl.onLink', item.$nav.level, link);\n            return link;\n        }\n\n        function onNav(item) {\n            console.log('RootCtrl.onNav', item.$nav.level, item.$nav.link);\n            return false; // disable default link behaviour;\n        }\n\n        function onNavPromise(item) {\n            $scope.selected = item;\n            return $promise(function(promise) {\n                console.log('RootCtrl.onNavPromise', item.$nav.level, item.$nav.link);\n                $timeout(function() {\n                    if (item.items) {\n                        item.$nav.addItems({\n                            title: \"Item\",\n                        });\n                    }\n                    promise.resolve();\n                });\n            }); // a promise always disable default link behaviour;\n        }\n\n        /*\n        $scope.onLink = onLink;\n        $scope.onNav = onNavPromise;\n        */\n\n        $scope.nav = nav;\n\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n    app.factory('Nav', function() {\n        function Nav(options) {\n            var nav = this;\n            var defaults = {\n                items: [],\n            }\n            angular.extend(nav, defaults);\n            if (options) {\n                angular.extend(nav, options);\n            }\n            nav.addNav(nav, null);\n        }\n        Nav.prototype = {\n            addNav: function(item, parent) {\n                var nav = this;\n                var $nav = {\n                    parent: parent || null,\n                    level: parent ? parent.$nav.level + 1 : 0,\n                    addItems: function(x) {\n                        nav.addItems(x, item);\n                    },\n                    onNav: nav.onNav,\n                };\n                item.$nav = $nav;\n                $nav.link = nav.getLink(item);\n            },\n            getLink: function(item) {\n                var link = null;\n                if (this.onLink) {\n                    link = this.onLink(item, item.$nav);\n                } else {\n                    link = item.link;\n                }\n                link = link || '#';\n                return link;\n            },\n            addItem: function(item, parent) {\n                var nav = this,\n                    onLink = nav.onLink,\n                    onNav = nav.onNav;\n                nav.addNav(item, parent);\n                if (parent) {\n                    parent.items = parent.items || [];\n                    parent.items.push(item);\n                }\n            },\n            addItems: function(itemOrItems, parent) {\n                var nav = this;\n                if (angular.isArray(itemOrItems)) {\n                    angular.forEach(itemOrItems, function(item) {\n                        nav.addItem(item, parent);\n                    });\n                } else {\n                    nav.addItem(itemOrItems, parent);\n                }\n            },\n            parse: function(items, parent) {\n                var nav = this;\n                if (items) {\n                    angular.forEach(items, function(item) {\n                        nav.addNav(item, parent);\n                        nav.parse(item.items, item);\n                    });\n                }\n            },\n            setItems: function(items) {\n                var nav = this;\n                nav.items = items;\n                nav.parse(items, nav);\n            },\n        };\n        return Nav;\n    });\n\n    app.directive('nav', ['$parse', 'Nav', function($parse, Nav) {\n        return {\n            restrict: 'A',\n            templateUrl: function(element, attributes) {\n                return attributes.template || 'partials/nav/nav';\n            },\n            scope: {\n                items: '=nav',\n            },\n            link: function(scope, element, attributes, model) {\n                scope.$watch('items', function(value) {\n                    // console.log(value instanceof Nav, value);\n                    if (value) {\n                        if (angular.isArray(value)) {\n                            var onLink = $parse(attributes.onLink)(scope.$parent);\n                            var onNav = $parse(attributes.onNav)(scope.$parent);\n                            var nav = new Nav({\n                                onLink: onLink,\n                                onNav: onNav\n                            });\n                            nav.setItems(value);\n                            scope.item = nav;\n\n                        } else if (value instanceof Nav) {\n                            scope.item = value;\n                        }\n                    }\n                });\n            }\n        };\n    }]);\n\n    app.directive('navItem', ['$timeout', function($timeout) {\n        return {\n            restrict: 'A',\n            templateUrl: function(element, attributes) {\n                return attributes.template || 'partials/nav/nav-item';\n            },\n            scope: {\n                item: '=navItem',\n            },\n            link: function(scope, element, attributes, model) {\n                var navItem = angular.element(element[0].querySelector('.nav-link'));\n                var state = {};\n                scope.item.$nav.state = state;\n\n                var output;\n\n                function itemOpen(item, immediate) {\n                    var state = item.$nav.state;\n                    state.active = true;\n\n                    $timeout(function() {\n                        state.immediate = immediate;\n                        state.closed = state.closing = false;\n                        state.opening = true;\n                        $timeout(function() {\n                            state.opening = false;\n                            state.opened = true;\n                        });\n                    });\n                }\n\n                function itemClose(item, immediate) {\n                    var state = item.$nav.state;\n                    state.active = false;\n                    $timeout(function() {\n                        state.immediate = immediate;\n                        state.opened = state.opening = false;\n                        state.closing = true;\n                        $timeout(function() {\n                            state.closing = false;\n                            state.closed = true;\n                        });\n                    });\n                    if (item.items) {\n                        angular.forEach(item.items, function(o) {\n                            itemClose(o, true);\n                        });\n                    }\n                }\n\n                function itemToggle(item) {\n                    // console.log('itemToggle', item);\n                    var state = item.$nav.state;\n                    state.active = item.items ? !state.active : true;\n                    if (state.active) {\n                        if (item.$nav.parent) {\n                            angular.forEach(item.$nav.parent.items, function(o) {\n                                if (o !== item) {\n                                    itemClose(o, true);\n                                }\n                            });\n                        }\n                        itemOpen(item);\n                    } else {\n                        itemClose(item);\n                    }\n                    // console.log(state);\n                }\n\n                function onTap(e) {\n                    var item = scope.item;\n                    // console.log('Item.onTap', item);\n                    var state = item.$nav.state;\n                    if (state.active) {\n                        output = false;\n                        trigger();\n                    } else if (item.$nav.onNav) {\n                        var promise = item.$nav.onNav(item, item.$nav);\n                        if (promise && typeof promise.then === 'function') {\n                            promise.then(function(resolved) {\n                                // go on\n                                trigger();\n                            }, function(rejected) {\n                                // do nothing\n                            });\n                            output = false;\n                        } else {\n                            output = promise;\n                            trigger();\n                        }\n                    }\n\n                    function trigger() {\n                        $timeout(function() {\n                            itemToggle(item);\n                        });\n                    }\n                }\n\n                function onTouchStart(e) {\n                    // console.log('Item.onTouchStart', e);\n                    onTap(e);\n                    navItem\n                        .off('mousedown', onMouseDown);\n                    // return r || prevent(e);\n                }\n\n                function onMouseDown(e) {\n                    // console.log('Item.onMouseDown', e);\n                    onTap(e);\n                    navItem\n                        .off('touchstart', onTouchStart);\n                    // return r || prevent(e);\n                }\n\n                function onClick(e) {\n                    // console.log('Item.onClick', e);\n                    return prevent(e);\n                }\n\n                function prevent(e) {\n                    if (output === false) {\n                        // console.log('Item.prevent', e);\n                        e.preventDefault();\n                        // e.stopPropagation();\n                        return false;\n                    }\n                }\n\n                function addListeners() {\n                    navItem\n                        .on('touchstart', onTouchStart)\n                        .on('mousedown', onMouseDown)\n                        .on('click', onClick);\n                }\n\n                function removeListeners() {\n                    navItem\n                        .off('touchstart', onTouchStart)\n                        .off('mousedown', onMouseDown)\n                        .off('click', onClick);\n                }\n\n                addListeners();\n\n                scope.$on('$destroy', function() {\n                    removeListeners();\n                });\n            }\n        };\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n    app.factory('$promise', ['$q', function($q) {\n        function $promise(callback) {\n            if (typeof callback !== 'function') {\n                throw ('promise resolve callback missing');\n            }\n            var deferred = $q.defer();\n            callback(deferred);\n            return deferred.promise;\n        }\n        return $promise;\n    }]);\n\n}());"]}